# Результаты тестирования фильтров

**Дата:** 2026-01-29
**Тестируемая версия:** v8.1.1

---

## Сводная таблица по версиям

| Версия | Дата | Golden | Гл.1 | Гл.2 | Гл.3 | Гл.4 | Всего | FP | Примечание |
|--------|------|--------|------|------|------|------|-------|-----|------------|
| **v5.2** | 25.01 | 72/72 | 75 | 51 | 139 | — | 265 | 193 | Базовая стабильная |
| **v5.7** | 26.01 | 72/72 | 65 | 48 | 84 | — | 197 | 125 | Оптимизированная |
| **v7.0** | 26.01 | 94/94 | 62 | 41 | 80 | 25 | 208 | 114 | Learned Rules |
| **v8.0** | 29.01 | 71/72 ✗ | 115 | 82 | 137 | — | 334 | 262 | Без pymorphy (баг) |
| **v8.1** | 29.01 | 70/72 ✗ | 97 | 77 | 127 | 49 | 350 | 256 | С pymorphy3 |
| **v8.1.1** | 29.01 | **94/94** ✓ | 99 | 77 | 131 | 49 | **356** | **262** | Исправлен proper_name |

**v8.0 проблема:** pymorphy2 не работает с Python 3.14.
**v8.1 проблема:** pymorphy3 ошибочно определял "когдато" как имя собственное.
**v8.1.1 решение:** Исправлена функция `_is_proper_name()` — теперь исключает составные слова.

---

## Детальные результаты v8.1.1

### Глава 1
- **Golden:** 31/31 (100%) ✓
- **Всего ошибок:** 99
- **Ложных срабатываний:** 68
- **Файл:** `01_yandex_transcript_NEW_20260125_1833_filtered.json`

### Глава 2
- **Golden:** 21/21 (100%) ✓
- **Всего ошибок:** 77
- **Ложных срабатываний:** 56
- **Файл:** `02_yandex_transcript_NEW_20260125_1838_filtered.json`

### Глава 3
- **Golden:** 20/20 (100%) ✓
- **Всего ошибок:** 131
- **Ложных срабатываний:** 111
- **Файл:** `03_yandex_transcript_NEW_20260125_1842_filtered.json`

### Глава 4
- **Golden:** 22/22 (100%) ✓
- **Всего ошибок:** 49
- **Ложных срабатываний:** 27
- **Файл:** `04_filtered.json`

### Итого по всем главам
- **Golden:** 94/94 (100%) ✓
- **Всего ошибок:** 356
- **Ложных срабатываний:** 262

---

## Исправленные баги в v8.1.1

### 1. Баг `какого→когда` (глава 3, 43:16)

**Проблема:**
- Слово "когда-то" после нормализации становилось "когдато"
- pymorphy3 ошибочно определял "когдато" как имя собственное (Name)
- Правило `morpho_proper_name` фильтровало ошибку как ложную

**Решение:**
Исправлена функция `_is_proper_name()` в `morpho_rules.py`:
```python
# Исключаем русские составные слова (когда-то → когдато)
compound_suffixes = ('то', 'либо', 'нибудь', 'таки', 'ка', 'де', 'мол')
word_lower = word.lower()
for suffix in compound_suffixes:
    if word_lower.endswith(suffix) and len(word_lower) > len(suffix) + 2:
        return False  # Не имя
```

### 2. Баг `или→и` (глава 1, 30:38)

**Проблема:**
- В golden стандарте указано `или→и`
- Яндекс на самом деле услышал "эли" вместо "или"
- smart_compare нашёл `эли→и`

**Решение:**
- Баг не в фильтре, а в golden стандарте (неточное указание wrong слова)
- Тест проходит, т.к. `correct` поле совпадает ("и")
- Система работает корректно

---

## Сравнение эффективности фильтрации

| Метрика | v5.7 | v7.0 | v8.1.1 |
|---------|------|------|--------|
| Golden тест | 72/72 | 94/94 | 94/94 |
| Всего ошибок | 197 | 208 | 356 |
| Ложные (FP) | 125 | 114 | 262 |
| Точность golden | 100% | 100% | 100% |
| FP rate | 63% | 55% | 74% |

**Вывод:** v8.1.1 достигла 100% golden на всех 94 ошибках. Количество FP выше чем у v5.7/v7.0 из-за консервативного подхода v8.x — лучше показать ложную ошибку, чем пропустить реальную.

---

## Следующие шаги

### v9.0 — Улучшение smart_compare
- Улучшение алгоритма выравнивания
- Уменьшение количества ложных ошибок на входе фильтра
- Контекстный анализ соседних слов

### v9.5 — Улучшение smart_filter
- ML-классификатор на основе базы данных ошибок
- Использование признаков: лемма, POS, число, падеж, время, фонетика
- Обучение на 600+ ложных и 94 golden ошибках

---

## Файлы результатов

```
Результаты проверки/
├── 01/01_yandex_transcript_NEW_20260125_1833_filtered.json  # v8.1.1
├── 02/02_yandex_transcript_NEW_20260125_1838_filtered.json  # v8.1.1
├── 03/03_yandex_transcript_NEW_20260125_1842_filtered.json  # v8.1.1
├── 04/04_filtered.json                                      # v8.1.1

Тесты/
├── golden_test_history.json  # История тестов
├── РЕЗУЛЬТАТЫ_ТЕСТИРОВАНИЯ.md  # Этот файл
```

---

*Автор: Claude Lead-Dev-Partner v2.0*
*Дата: 2026-01-29*
