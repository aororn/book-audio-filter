# Оценка качества инструмента analyze_false_positives.py

**Дата:** 2026-01-25
**Версия инструмента:** 1.0 (analyze_false_positives.py)
**Тестовые данные:** Глава 3, 105 ложных ошибок

---

## Методология тестирования

1. **Автоматический анализ** — запуск `analyze_false_positives.py 03 --no-golden --limit 150`
2. **Ручной анализ** — детальная проверка каждой из 105 ложных ошибок с контекстом
3. **Сравнение** — подсчёт совпадений/расхождений классификации

---

## Результаты

### Общая точность автоанализа

| Метрика | Значение |
|---------|----------|
| Всего проанализировано | 105 ошибок |
| Правильно классифицировано | 76 ошибок |
| **Accuracy (точность)** | **72.4%** |

### Точность по категориям

| Категория | Ручной анализ | Автоанализ нашёл | Precision | Recall |
|-----------|--------------|------------------|-----------|--------|
| ОКОНЧАНИЕ | 53 | 44 правильно | 83% | 83% |
| ВСТАВКА | 12 | 11 правильно | 100% | 92% |
| ФОНЕТИКА | 14 | 8 правильно | 35% | 57% |
| ПРЕФИКС | 14 | 8 правильно | 62% | 57% |
| УДАЛЕНИЕ | 4 | 4 правильно* | 40% | 100% |
| ШУМ | 6 | - (как НЕИЗВЕСТНО) | - | 0% |
| ИМЕНА | 1 | - (как ФОНЕТИКА) | - | 0% |
| НАСТОЯЩАЯ | 1 | - (как НЕИЗВЕСТНО) | - | 0% |

*Автоанализ также классифицировал как УДАЛЕНИЕ 6 ошибок, которые на самом деле ПРЕФИКС

### Матрица ошибок (Confusion Matrix)

```
                        Автоанализ →
Ручной ↓     | ОКОНЧАНИЕ | ФОНЕТИКА | ПРЕФИКС | ВСТАВКА | УДАЛЕНИЕ | НЕИЗВЕСТНО |
-------------|-----------|----------|---------|---------|----------|------------|
ОКОНЧАНИЕ    |    44     |    9     |    0    |    0    |    0     |     0      |
ФОНЕТИКА     |     1     |    8     |    0    |    0    |    0     |     5      |
ПРЕФИКС      |     0     |    1     |    8    |    0    |    5     |     0      |
ВСТАВКА      |     0     |    0     |    0    |   11    |    1     |     0      |
УДАЛЕНИЕ     |     0     |    0     |    0    |    0    |    4     |     0      |
ШУМ          |     0     |    0     |    0    |    0    |    0     |     6      |
ИМЕНА        |     0     |    1     |    0    |    0    |    0     |     0      |
НАСТОЯЩАЯ    |     0     |    0     |    0    |    0    |    0     |     1      |
```

---

## Анализ ошибок автоанализа

### 1. Путаница ОКОНЧАНИЕ↔ФОНЕТИКА (9 случаев)
**Причина:** Инструмент определяет ФОНЕТИКА по созвучию, но не учитывает, что различие только в окончании.

**Примеры:**
- искателей→искатели — ФОНЕТИКА (авто) vs ОКОНЧАНИЕ (ручной)
- созданы→созданный — ФОНЕТИКА (авто) vs ОКОНЧАНИЕ (ручной)

**Решение:** Добавить проверку: если различие только в конце слова (1-3 символа), классифицировать как ОКОНЧАНИЕ.

### 2. Нераспознанные связанные пары ПРЕФИКС (5 случаев)
**Причина:** Слово разбито на два (не молот, бес полной), инструмент видит их как отдельные ошибки.

**Примеры:**
- не молот → deletion(-молот) + substitution(немолод→не)
- на встречу → substitution(навстречу→на) + deletion(-встречу)

**Решение:** Добавить детектор "связанных ошибок" — если две ошибки в пределах 1 секунды и их слова можно объединить.

### 3. Много НЕИЗВЕСТНО (21 → 12 реальных случаев)
**Причина:** Строгие паттерны не покрывают все варианты.

**Из них:**
- 6 — реально ШУМ (артефакты выравнивания)
- 5 — реально ФОНЕТИКА (нетипичные созвучия)
- 1 — реально НАСТОЯЩАЯ ошибка

**Решение:** Расширить паттерны ФОНЕТИКА, добавить категорию ШУМ.

### 4. Не распознаются ИМЕНА (1 случай)
**Причина:** Нет словаря персонажей книги.

**Пример:** изарда→зарда (имя Изарда)

**Решение:** Загружать словарь имён из character_names_dict.json

---

## Рекомендации по улучшению

### Приоритет 1 (быстрые улучшения)
1. **Уточнить границу ОКОНЧАНИЕ/ФОНЕТИКА** — если различие в последних 1-3 буквах, это ОКОНЧАНИЕ
2. **Добавить детектор связанных ошибок** — объединять ошибки в пределах 1 секунды

### Приоритет 2 (средние улучшения)
3. **Добавить категорию ШУМ** — когда контексты оригинала и транскрипта не пересекаются
4. **Интегрировать словарь имён** — для автоматического распознавания ошибок в именах

### Приоритет 3 (длительные улучшения)
5. **Machine Learning модель** — обучить на размеченных данных для автоклассификации
6. **Расширить паттерны ФОНЕТИКА** — добавить больше типичных созвучий русского языка

---

## Качество golden_filter (побочный результат)

При ручном анализе также оценена точность основного фильтра:

| Метрика | Значение |
|---------|----------|
| Ложных срабатываний | 105 |
| Истинно ложных | 104 |
| Возможно настоящих ошибок | 1 (бриджи→бред) |
| **Precision фильтра** | **99.0%** |

**Вывод:** golden_filter работает отлично, практически не пропускает настоящие ошибки.

---

## Итоговая оценка

| Компонент | Оценка | Комментарий |
|-----------|--------|-------------|
| analyze_false_positives.py | **B (72%)** | Хорошо для ОКОНЧАНИЕ/ВСТАВКА, слабо для связанных ошибок |
| golden_filter | **A+ (99%)** | Отличная фильтрация ложных срабатываний |

---

## Файлы анализа

- `Тесты/ручной_анализ_глава3.md` — детальный анализ каждой из 105 ошибок
- `Тесты/оценка_качества_автоанализа.md` — этот файл (итоговый отчёт)
