# Проверка аудиокниг через Яндекс SpeechKit

**Версия:** 11.6.0 | **Дата:** 2026-01-30

> Полная документация: `Документация/Архив/PROJECT_FULL.md`

## Текущие показатели

| Метрика | Значение |
|---------|----------|
| **Golden** | 93/93 ✓ |
| **Всего ошибок** | 247 |
| **Отфильтровано** | 694 |
| **Осталось FP** | 154 |
| **Строк кода** | ~29,000 |
| **Python файлов** | 57 |

### Сравнение версий

```bash
python Инструменты/version_table.py
```

| Версия | Дата | Filter | Гл.1 | Гл.2 | Гл.3 | Гл.4 | Всего | FP |
|--------|------|--------|------|------|------|------|-------|-----|
| v5.7.2 | 25.01 | 5.7.0 | 62 | 46 | 88 | — | 196 | 124 |
| v10.0 | 29.01 | 8.0.0 | 99 | 73 | 124 | 61 | 357 | 264 |
| v11.5 | 30.01 | 8.9.0 | 74 | 45 | 80 | 48 | 247 | 154 |

### База данных ошибок

Все ошибки хранятся в `Словари/false_positives.db` с метриками:
- Морфология: лемма, POS, same_lemma, same_pos
- Семантика: semantic_similarity (Navec 300d)
- Частотность: frequency (НКРЯ)
- Статус: is_golden, is_filtered, filter_reason

## Архитектура v11.6

```
Аудио → Яндекс SpeechKit → Транскрипция
                                ↓
Оригинал → Нормализация → Умное сравнение → Фильтрация → Ошибки
                                ↓
                         JSON / DOCX / Веб
```

### Ключевые модули

| Модуль | Версия | Назначение |
|--------|--------|------------|
| smart_compare.py | v10.5 | Посегментное выравнивание |
| engine.py | v8.9.0 | Фильтрация (25+ уровней) |
| SemanticManager | v2.0 | Семантика (Navec 500K слов) |
| SmartScorer | v3.0 | Накопительный скоринг |
| MorphoRules | v1.1 | Морфологические правила |
| FrequencyManager | v1.0 | Частотный словарь НКРЯ |

### Новое в v11.6

| Модуль | Версия | Назначение |
|--------|--------|------------|
| version_table.py | v1.0 | Унифицированные таблицы версий |
| versions.json | v1.0 | Единый источник правды для метрик |
| run_full_test.py | v6.3 | Автозапись в versions.json |

## Быстрый старт

```bash
# Полный пайплайн
python Инструменты/pipeline.py глава.mp3 оригинал.docx

# С веб-интерфейсом
python Инструменты/pipeline.py глава.mp3 оригинал.docx --web

# Тесты
python Тесты/run_full_test.py           # все главы
python Тесты/run_full_test.py --clean   # чистое тестирование
pytest -v                                # unit-тесты

# Сравнение версий
python Инструменты/version_table.py              # все версии
python Инструменты/version_table.py v5.7 v11.5   # сравнить
python Инструменты/version_table.py --current    # текущие метрики
```

## Структура проекта

```
Яндекс Спич/
├── Инструменты/
│   ├── pipeline.py          # Полный пайплайн
│   ├── smart_compare.py     # Умное сравнение
│   ├── version_table.py     # Таблицы версий (NEW)
│   ├── filters/
│   │   ├── engine.py        # Движок фильтрации v8.9
│   │   ├── semantic_manager.py  # Navec семантика
│   │   ├── smart_scorer.py  # Накопительный скоринг
│   │   ├── frequency_manager.py  # Частотный словарь
│   │   ├── morpho_rules.py  # Морфология
│   │   └── ...
│   ├── false_positives_db.py
│   └── ...
├── Тесты/
│   ├── run_full_test.py     # Полный тест v6.3
│   ├── versions.json        # Единый источник метрик (NEW)
│   ├── История/             # Архив прогонов
│   ├── золотой_стандарт_глава*.json
│   └── ...
├── Словари/
│   ├── Словарь_имён_персонажей.txt
│   ├── frequency_dict.json  # Частотный словарь НКРЯ
│   └── false_positives.db
├── Результаты проверки/
├── PROJECT.md
├── ROADMAP.md
└── CHANGELOG.md
```

## Принципы фильтрации

1. **Консервативность** — при сомнении НЕ фильтруем
2. **Golden = 100%** — ни одна реальная ошибка не должна быть отфильтрована
3. **Грамматика = реальная ошибка** — разные леммы/падежи/числа = реальные ошибки чтеца
4. **Без хардкодов** — правила работают на любых данных

### Ключевое правило

**Одинаковая лемма НЕ означает ложную ошибку!**

Если лемма одинаковая, но есть грамматические различия — это РЕАЛЬНАЯ ошибка:
- `сотни → сотня` — разное число
- `теряю → теряя` — VERB → GRND
- `получится → получилось` — разный вид
- `ключ → ключа` — разный падеж

## Типы ошибок

- **substitution** — замена слова (ЖИВЁМ → живы)
- **insertion** — лишнее слово
- **deletion** — пропуск слова
- **transposition** — перестановка (ТЫ ЧТО → что ты)

## Зависимости

```bash
pip install pymorphy3 thefuzz python-docx num2words navec
```

---

*Версия: 11.6.0 (2026-01-30)*
